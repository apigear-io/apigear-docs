"use strict";(self.webpackChunkapigear=self.webpackChunkapigear||[]).push([[4136],{93288:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"tools/cli/simulate","title":"API Simulation and Stimulation","description":"API Simulation is when a script simulates the behavior of an ApiGear API. API Stimulation is when a script drives the implementation of an ApiGear API. Simulation is great for consumers of APIs, sich as user interfaces or CLIs to validate their implementation without having access to the finished API implementation and with greater flexibility. An API Stimulation is great when you implement and API and want to drive your implementation for validation.","source":"@site/docs/tools/cli/simulate.md","sourceDirName":"tools/cli","slug":"/tools/cli/simulate","permalink":"/docs/tools/cli/simulate","draft":false,"unlisted":false,"editUrl":"https://github.com/apigear-io/apigear-docs/edit/main/docs/tools/cli/simulate.md","tags":[],"version":"current","lastUpdatedAt":1750096349000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"SDK Templates","permalink":"/docs/tools/cli/template"},"next":{"title":"API Monitoring","permalink":"/docs/tools/cli/monitor"}}');var o=i(74848),a=i(28453);const l={sidebar_position:3},s="API Simulation and Stimulation",r={},c=[{value:"API Simulation",id:"api-simulation",level:2},{value:"Quick API Simulation",id:"quick-api-simulation",level:3},{value:"Service API",id:"service-api",level:3},{value:"Bare Service API",id:"bare-service-api",level:3},{value:"Ball Exampple",id:"ball-exampple",level:3},{value:"API Stimulation",id:"api-stimulation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"api-simulation-and-stimulation",children:"API Simulation and Stimulation"})}),"\n",(0,o.jsx)(n.p,{children:"API Simulation is when a script simulates the behavior of an ApiGear API. API Stimulation is when a script drives the implementation of an ApiGear API. Simulation is great for consumers of APIs, sich as user interfaces or CLIs to validate their implementation without having access to the finished API implementation and with greater flexibility. An API Stimulation is great when you implement and API and want to drive your implementation for validation."}),"\n",(0,o.jsx)(n.h2,{id:"api-simulation",children:"API Simulation"}),"\n",(0,o.jsxs)(n.p,{children:["API Simulation is a feature that allows you to simulate the behavior of an API. This is useful for testing, demonstration, and development. It decouples the interface implementation from the interface users. The simulation is based on ",(0,o.jsx)(n.a,{href:"/docs/advanced/protocols/objectlink/intro",children:"olink protocol"}),", you need your application to use Object Link version of implementation to be able to receive the simulation data. Check your templates for ",(0,o.jsx)(n.code,{children:"olink"})," feature for more information.\nSee ",(0,o.jsx)(n.a,{href:"/docs/advanced/simulation/intro",children:"simulation documentation"})," for more info."]}),"\n",(0,o.jsx)(n.admonition,{title:"Beta",type:"note",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.strong,{children:"simulation"})," server is in beta and will gain new and improved functionality soon."]})}),"\n",(0,o.jsx)(n.h3,{id:"quick-api-simulation",children:"Quick API Simulation"}),"\n",(0,o.jsxs)(n.p,{children:["API Simulation is a feature of the ApiGear platform. It allows to simulate the behavior of an API. The ",(0,o.jsx)(n.code,{children:"apigear"})," command line tool can be used to simulate an API. The following example shows how to simulate the demo API."]}),"\n",(0,o.jsxs)(n.p,{children:["API simulation is based on a simulation script. The following example shows how to create a simulation script for the ",(0,o.jsx)(n.a,{href:"generate",children:"demo API"})," used for code generation example."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'// demo.script.js\n\nconst counter = $createService("demo.Counter", { count: 0 });\ncounter.increment = function() {\n    counter.count++;\n    return counter;\n}\n\ncounter.decrement = function() {\n    counter.count--;\n    return counter;\n}\n\n// use the "$" scope to access the bare methods\ncounter.$.onProperty("count", function(value) {\n    console.log("count is", value)\n})\n\n\nfunction main() {\n    console.log("main function is run automatically when script is loaded")\n    counter.increment()\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Now we can run the simulation server using the following command. This scenario does not include a main function to run on startup. It simulates the operations on interface and provides initial state for properties. For steps simulation see ",(0,o.jsx)(n.a,{href:"/docs/advanced/simulation/intro",children:"scenario documentation"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"apigear sim run counter.js\n"})}),"\n",(0,o.jsxs)(n.p,{children:["It will load the simulation scenario from the ",(0,o.jsx)(n.code,{children:"counter.js"}),' file. The simulation server will listen for API calls. The simulation server by default is "127.0.0.1:4333". To change the address use the ',(0,o.jsx)(n.code,{children:"--addr"})," option. ",(0,o.jsx)("br",{}),"\nThe example simulates a server side and normally the API calls will come from a running API client."]}),"\n",(0,o.jsx)(n.h3,{id:"service-api",children:"Service API"}),"\n",(0,o.jsx)(n.p,{children:"The service API is a proxy API, which means it is shaped after the data you place inside."}),"\n",(0,o.jsxs)(n.p,{children:["For example when you define a property using ",(0,o.jsx)(n.code,{children:'demo.$.setProperty("count", 10)'})," the proxy will have a ",(0,o.jsx)(n.code,{children:"count"})," property."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'demo = $createService("demo", { city: "Paris"})\n// access the bare API to set another property\ndemo.$.setProperty("count", 10)\ndemo.count = 11\ndemo.count++\nconsole.log(demo.count)\n'})}),"\n",(0,o.jsx)(n.h3,{id:"bare-service-api",children:"Bare Service API"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const demo = $createBareService(name, props)\ndemo.setProperty(key, value)\ndemo.getProperty(key)\ndemo.onProperty(key, callback)\n\ndemo.setMethod(name, callback)\ndemo.getMethod(name): calback\ndemo.callMethod(name, args)\n\ndemo.emitSignal(name, args)\ndemo.onSignal(name, callback)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The bare API is accesssible using the ",(0,o.jsx)(n.code,{children:"$"})," scope in a regular service."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const demo = $createService(name, props)\n// accessing the bare API\ndemo.$.setProperty(key, value)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"ball-exampple",children:"Ball Exampple"}),"\n",(0,o.jsx)(n.p,{children:"Base on this API"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"module demo\n\nstruct Vec2D {\n    x: float,\n    y: float\n}\n\ninterface Ball {\n    pos: Vec2D\n    vel: Vec2D\n    acc: Vec2D\n    move()\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"We can create a simulation for this"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'const ball = $createService("demo.Ball", {\n    pos: { x: 0, y: 0 },\n    vel: { x: 1, y: 1 },\n    acc: { x: 1, y: 1 },\n});\n\n\nball.move = function() {\n    var acc = ball.acc;\n    var vel = ball.vel;\n    var pos = ball.pos;\n    var newPos = { x: pos.x + vel.x, y: pos.y + vel.y };\n    var newVel = { x: vel.x + acc.x, y: vel.y + acc.y };\n    ball.pos += newPos;\n    ball.vel = newVel;\n};\n\n    \nball.$.onProperty("pos", function (value) {\n    console.log("pos changed", JSON.stringify(value));\n});\n\nball.$.onProperty("vel", function (value) {\n    console.log("vel changed", JSON.stringify(value));\n});\n\nball.$.onProperty("acc", function (value) {\n    console.log("acc changed", JSON.stringify(value));\n});\n\nfunction main() {\n    console.log("start");\n    for (let i = 0; i < 10; i++) {\n        ball.move()\n    }\n    console.log("finish", JSON.stringify(ball.$.getProperties()));\n    $quit();\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"api-stimulation",children:"API Stimulation"}),"\n",(0,o.jsx)(n.p,{children:"API Stimulation requires a connection to an external service using the ObjectLink protocol. For this we fist neeed to create a channel to stream the data and then on the stream create the client to interacte with the remote service."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'const url = "ws://localhost:5555/ws"\n// tries to connect to remote server\nconst channel = $createChannel(url)\n// links to the demo.Ball service\nconst ball = channel.createClient("demo.Ball")\n// calls the remote method "move"\nball.callMethod("move")\n\nfunction main() {\n    for (let i = 0; i < 10; i++) {\n        ball.callMethod("move")\n    }\n}\n'})})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>s});var t=i(96540);const o={},a=t.createContext(o);function l(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);